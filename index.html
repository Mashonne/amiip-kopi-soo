<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aggregate Results</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" /> -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto Mono:wght@400;700&display=swap"
    />
    <style>
      body {
        background-color: black;
        color: white;
        font-family: "Roboto Mono", monospace;
        min-height: 100vh;
      }
    </style>
  </head>
  <body>
    <div
      class="flex flex-col sm:h-screen justify-between gap-[30px] sm:py-[50px] xl:py-[60px] py-[30px] px-[30px] sm:px-[60px] xl:px-[70px]"
    >
      <div
        class="flex justify-start gap-[20px] xl:justify-between flex-col xl:flex-row"
      >
        <!-- <span
          class="w-full text-[24px] sm:text-[30px] xl:text-[50px] flex-1 order-2 xl:order-1 xl:item-center"
        > -->
        <span
          class="w-full text-[24px] sm:text-[30px] xl:text-[3vw] font-semibold flex-1 order-2 xl:order-1 xl:item-center"
        >
          Can you identify <br />
          the AI imposter?
        </span>
        <div
          class="text-[20px] sm:text-[30px] order-1 xl:order-2 flex xl:justify-end"
        >
          <div class="w-2/3 flex xl:justify-end sm:w-[300px] xl:w-[25vw]">
            <img src="./logo.svg" alt="Image" />
          </div>
        </div>
      </div>
      <div class="flex w-full flex-col xl:flex-row justify-between gap-[20px] xl:items-start">

          <div class="flex flex-col w-full gap-[30px]"> 
            <div>
                <span class="text-[10px] font-semibold sm:text-[16px] xl:text-[1vw] px-[7px] text-black bg-white">
                    TOTAL OUTCOMES
                </span>
            </div>         
             <div class="flex flex-col xl:flex-row justify-between">
                <div class="w-full xl:w-7/12">
                    <!-- <canvas id="resultsChart" height="110""></canvas> -->
                    <canvas id="resultsChart"></canvas>
                </div>
             </div>
            <div class="flex justify-between uppercase sm:justify-start sm:gap-[30px]">
              <div class="flex gap-[6px] items-center">
                <div class="rounded-full p-[6px] sm:p-[10px] bg-[#ff8200]"></div>
                <span class="text-[10px] sm:text-[16px]">Video Results</span>
              </div>
              <div class="flex gap-[6px] items-center">
                <div class="rounded-full p-[6px] sm:p-[10px] bg-[#ffdc00]"></div>
                <span class="text-[10px] sm:text-[16px]">Audio Results</span>
              </div>
              <div class="flex gap-[6px] items-center">
                <div class="rounded-full p-[6px] sm:p-[10px] bg-[#8a68c8]"></div>
                <span class="text-[10px] sm:text-[16px]">Photo Results</span>
              </div>
            </div>
          </div>
            <div class="flex flex-col gap-[30px] xl:gap-[1.1vw]">
                <div>
                    <span class="text-[10px] font-semibold sm:text-[16px] xl:text-[1vw] px-[7px] text-black bg-white">
                        LAST 20 MINUTES
                    </span>
                </div>
                <div class="flex flex-row xl:flex-col gap-[10px] xl:gap-[1vw]">
                    <div class="flex px-[10px] xl:px-[1vw] sm:px-[20px] flex-col w-full py-[5px] xl:w-[12vw] border-white border-[2px] xl:border-[0.15vw] rounded-[10px] xl:rounded-[1vw]">
                        <span class="text-[10px] sm:text-[16px] xl:text-[1vw] uppercase">AMATEUR</span>
                        <span class="text-[25px] sm:text-[40px] xl:text-[3.5vw] font-medium text-center">
                            +1
                        </span>
                    </div>
                    <div class="flex px-[10px] xl:px-[1vw] sm:px-[20px] flex-col w-full py-[5px] xl:w-[12vw] border-white border-[2px] xl:border-[0.15vw] rounded-[10px] xl:rounded-[1vw]">
                        <span class="text-[10px] sm:text-[16px] xl:text-[1vw] uppercase">Trainee</span>
                        <span class="text-[25px] sm:text-[40px] xl:text-[3.5vw] font-medium text-center">
                            +2
                        </span>
                    </div>
                    <div class="flex px-[10px] xl:px-[1vw] sm:px-[20px] flex-col w-full py-[5px] xl:w-[12vw] border-white border-[2px]  xl:border-[0.15vw] rounded-[10px] xl:rounded-[1vw]">
                        <span class="text-[10px] sm:text-[16px] xl:text-[1vw] uppercase">Pro</span>
                        <span class="text-[25px] sm:text-[40px] xl:text-[3.5vw] font-medium text-center">
                            +0
                        </span>
                    </div>
                </div>
            </div>
      </div>
    </div>
    <!-- <script>
      let chart;

      // Function to fetch data from Airtable
      async function fetchData() {
        const response = await fetch(
          "https://api.airtable.com/v0/appoOC9OGPSRRgACV/Table%201",
          {
            headers: {
              Authorization:
                "Bearer patFK6oNVppWSAEvw.3094966f5fcde47173d52773003596dff4ff9a391626e00ff8bdbc87067f6c15",
              "Content-Type": "application/json",
            },
          }
        );
        const data = await response.json();
        return data.records;
      }

      // Function to process and aggregate data
      function processResults(records) {
        const results = {
          image: { amateurs: 0, pros: 0, rookies: 0 },
          audio: { amateurs: 0, pros: 0, rookies: 0 },
          video: { amateurs: 0, pros: 0, rookies: 0 },
        };

        const now = new Date();
        const pastTime = new Date(now.getTime() - 20 * 60000); // 20 minutes ago

        let recentCounts = { amateurs: 0, pros: 0, rookies: 0 };

        records.forEach((record) => {
          const quizType = record.fields.Quiz;
          const resultName = record.fields.Result_name;
          const createdTime = new Date(record.createdTime);

          if (quizType && resultName) {
            if (resultName.includes("Amateur")) {
              results[quizType].amateurs++;
            } else if (resultName.includes("Pro")) {
              results[quizType].pros++;
            } else if (resultName.includes("Rookie")) {
              results[quizType].rookies++;
            }

            if (createdTime >= pastTime) {
              if (resultName.includes("Amateur")) {
                recentCounts.amateurs++;
              } else if (resultName.includes("Pro")) {
                recentCounts.pros++;
              } else if (resultName.includes("Rookie")) {
                recentCounts.rookies++;
              }
            }
          }
        });

        document.getElementById("amateur-count").textContent =
          recentCounts.amateurs;
        document.getElementById("rookie-count").textContent =
          recentCounts.rookies;
        document.getElementById("pro-count").textContent = recentCounts.pros;

        return results;
      }

      // Create chart data
      function createChartData(results) {
        return {
          labels: ["Amateur", "Trainee", "Pro"],

          datasets: [
            {
              label: "Audio",
              data: [
                results.audio.amateurs,
                results.audio.rookies,
                results.audio.pros,
              ],
              backgroundColor: "#FFDC00", // Yellow
              borderColor: "#FFDC00",
              borderWidth: 1,
            },
            {
              label: "Video",
              data: [
                results.video.amateurs,
                results.video.rookies,
                results.video.pros,
              ],
              backgroundColor: "#FF8200", // orange
              borderColor: "#FF8200",
              borderWidth: 1,
            },
            {
              label: "Photo",
              data: [
                results.image.amateurs,
                results.image.rookies,
                results.image.pros,
              ],
              backgroundColor: "#8A68C8", // Purple
              borderColor: "#8A68C8",
              borderWidth: 1,
            },
          ],
        };
      }

      // Chart options for better UX
      const options = {
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            display: false,
          },
          x: {
            ticks: {
              color: "white", // set x-axis label color to white
              font: {
                size: 25,
                family: "Roboto Mono",
                position: "left",
              },
            },
          },
        },
        plugins: {
          legend: {
            display: false,
          },
        },
      };

      // Function to render Chart
      function renderChart(ctxId, chartData) {
        const ctx = document.getElementById(ctxId).getContext("2d");
        if (chart) {
          chart.destroy(); // Destroy the existing chart if it exists
        }
        chart = new Chart(ctx, {
          type: "bar",
          data: chartData,
          options: options,
        });
      }

      // Function to fetch data and update chart
      async function updateChart() {
        const records = await fetchData();
        const results = processResults(records);
        const chartData = createChartData(results);
        renderChart("resultsChart", chartData);
      }

      // Fetch and render the data when the window loads
      window.onload = function () {
        updateChart();
        setInterval(updateChart, 60000); // Update chart every 60 seconds (60000 milliseconds)
      };
    </script> -->
    <script>
      let chart;
    
      async function fetchData() {
        const response = await fetch(
          "https://api.airtable.com/v0/appoOC9OGPSRRgACV/Table%201",
          {
            headers: {
              Authorization:
                "Bearer patFK6oNVppWSAEvw.3094966f5fcde47173d52773003596dff4ff9a391626e00ff8bdbc87067f6c15",
              "Content-Type": "application/json",
            },
          }
        );
        const data = await response.json();
        return data.records;
      }
    
      // Function to process and aggregate data
      function processResults(records) {
        const results = {
          image: { amateurs: 0, pros: 0, rookies: 0 },
          audio: { amateurs: 0, pros: 0, rookies: 0 },
          video: { amateurs: 0, pros: 0, rookies: 0 },
        };
    
        records.forEach((record) => {
          const quizType = record.fields.Quiz.toLowerCase();
          const resultName = record.fields.Result_name;
    
          if (quizType && resultName) {
            if (resultName.includes("Amateur")) {
              results[quizType].amateurs++;
            } else if (resultName.includes("Pro")) {
              results[quizType].pros++;
            } else if (resultName.includes("Rookie")) {
              results[quizType].rookies++;
            }
          }
        });
    
        return results;
      }
    
      // Create chart data
      function createChartData(results) {
        return {
          labels: ["Amateur", "Trainee", "Pro"],
          datasets: [
            {
              label: "Audio",
              data: [
                results.audio.amateurs,
                results.audio.rookies,
                results.audio.pros,
              ],
              backgroundColor: "#FFDC00", 
              borderColor: "#FFDC00",
              borderWidth: 1,
            },
            {
              label: "Video",
              data: [
                results.video.amateurs,
                results.video.rookies,
                results.video.pros,
              ],
              backgroundColor: "#FF8200",
              borderColor: "#FF8200",
              borderWidth: 1,
            },
            {
              label: "Photo",
              data: [
                results.image.amateurs,
                results.image.rookies,
                results.image.pros,
              ],
              backgroundColor: "#8A68C8",
              borderColor: "#8A68C8",
              borderWidth: 1,
            },
          ],
        };
      }

      const options = {
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              display: false, 
              stepSize: 15, 
            },
            grid: {
              borderDash: [10, 15], 
              color: "#888888",
            },
          },
          x: {
              ticks: {
                  color: "white", 
                  font: {
                      size: window.innerWidth < 768 ? 12 : 25,
                      family: "Roboto Mono",
                  },
              },
          },
        },
        plugins: {
          legend: {
            display: false, 
          },
        },
        responsive: true,
        barPercentage: 0.8, 
        categoryPercentage: 0.7, 
      }
    
      function renderChart(chartData) {
        const ctx = document.getElementById("resultsChart").getContext("2d");
        if (chart) {
          chart.destroy(); 
        }
        chart = new Chart(ctx, {
          type: "bar",
          data: chartData,
          options: options,
        });
      }
    
      async function updateChart() {
        const records = await fetchData();
        const results = processResults(records);
        const chartData = createChartData(results);
        renderChart(chartData);
      }
    
      window.onload = function () {
        updateChart();
        setInterval(updateChart, 60000); 
      };
    </script>
  </body>
</html>
